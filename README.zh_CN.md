![Web Highlighter](https://raw.githubusercontent.com/alienzhou/web-highlighter/master/docs/img/logo.png)

âœ¨A no-runtime dependency lib for highlighting-note & persistence on any website âœ¨ğŸ–ï¸

[![NPM version](https://img.shields.io/npm/v/web-highlighter.svg)](https://www.npmjs.com/package/web-highlighter)  [![version](https://img.shields.io/badge/version-0.3.3-blue.svg?cacheSeconds=2592000)](https://github.com/alienzhou/web-highlighter)  [![](https://api.travis-ci.org/alienzhou/web-highlighter.svg?branch=master)](https://travis-ci.org/alienzhou/web-highlighter) [![codebeat badge](https://codebeat.co/badges/f5a18a9b-9765-420e-a17f-fa0b54b3a125)](https://codebeat.co/projects/github-com-alienzhou-web-highlighter-master) [![MIT Licence](https://badges.frapsoft.com/os/mit/mit.svg?v=103)](https://opensource.org/licenses/mit-license.php)

[English](https://github.com/alienzhou/web-highlighter/blob/master/README.md) | ç®€ä½“ä¸­æ–‡

## èƒŒæ™¯

çµæ„Ÿæ¥æºï¼šå½“æœ‰å¤©æˆ‘è®¿é—®æŸä¸ªç½‘é¡µæ—¶ï¼Œçªç„¶å¸Œæœ›èƒ½å¤Ÿåƒåœ¨PDFä¸Šä¸€æ ·ï¼Œå¯¹ç½‘é¡µæ–‡æœ¬æ·»åŠ é«˜äº®ç¬”è®°ï¼Œå¹¶æ”¯æŒæ°¸ä¹…ä¿å­˜è¿™äº›é«˜äº®ç¬”è®°åŒºåŸŸã€‚

å¦‚æœä½ æ›¾ç»è®¿é—®è¿‡ [medium.com](http://medium.com) è¿™ä¸ªç½‘ç«™ï¼Œä½ ä¸€å®šè§åˆ°æˆ–ç”¨è¿‡å®ƒçš„é«˜äº®åœ¨çº¿ç¬”è®°åŠŸèƒ½ï¼šç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µç„¶åç‚¹å‡»â€œé«˜äº®â€æŒ‰é’®ï¼Œæ¥ç€ï¼Œè¿™æ®µæ–‡æœ¬å°±è¢«æ¶‚ä¸Šäº†èƒŒæ™¯é¢œè‰²ã€‚æ­¤å¤–ï¼Œè¿™äº›é«˜äº®åŒºåŸŸè¿˜è¢«å­˜å‚¨äº†ä¸‹æ¥ï¼Œå½“ä½ ä¸‹æ¬¡è®¿é—®æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚å°±åƒä¸‹é¢è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸€æ ·ã€‚

![](./docs/img/sample.gif)

å¯¹åœ¨çº¿é˜…è¯»å™¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ã€‚å¦‚æœä½ æ˜¯å¼€å‘è€…ï¼Œä¹Ÿè®¸ä½ ä¼šå¸Œæœ›åœ¨ä½ çš„ç½‘é¡µä¸Šæ”¯æŒè¯¥åŠŸèƒ½ä»¥å¸å¼•æ›´å¤šçš„è¯»è€…ï¼›å¦‚æœä½ æ˜¯ä¸€åç”¨æˆ·ï¼ˆåƒæˆ‘ä¸€æ ·ï¼‰ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦ä¸€ä¸ªæ”¯æŒè¯¥åŠŸèƒ½çš„æµè§ˆå™¨æ’ä»¶ã€‚

å› æ­¤ï¼Œã€Œweb-highlighterã€ä»“åº“çš„ç›®æ ‡å°±æ˜¯å¸®åŠ©ä½ åœ¨ä»»æ„çš„ç½‘é¡µä¸Šå¿«é€Ÿåœ°å®ç°é«˜äº®ç¬”è®°åŠŸèƒ½ï¼ˆä¾‹å¦‚åšå®¢ç½‘é¡µã€æ–‡æ¡£é˜…è¯»å™¨ã€åœ¨çº¿å›¾ä¹¦ç­‰ï¼‰ã€‚å®ƒåŒ…å«äº†æ–‡æœ¬é«˜äº®ç¬”è®°ä¸é«˜äº®æŒä¹…åŒ–ä¸‹åœºæ™¯çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¹¶ä¸”æ”¯æŒé€šè¿‡å®ƒç®€å•æ˜“ç”¨çš„ API æ¥å®ç°ä½ è‡ªå·±çš„äº§å“éœ€æ±‚ã€‚ã€Œweb-highlighterã€å·²ç»è¢«ç”¨åœ¨äº†æˆ‘ä»¬ç½‘ç«™çš„ç”Ÿäº§ç¯å¢ƒä¸­ã€‚


## å®‰è£…

```bash
npm i web-highlighter
```

## ä½¿ç”¨æ–¹å¼

ä¸¤è¡Œä»£ç ï¼Œå³å¯å¼€å¯æ–‡æœ¬é€‰ä¸­æ—¶çš„è‡ªåŠ¨é«˜äº®åŠŸèƒ½ã€‚

```JavaScript
import Highlighter from 'web-highlighter';
(new Highlighter()).run();
```

å››è¡Œä»£ç ï¼Œå®ç°é«˜äº®åŒºåŸŸæŒä¹…åŒ–ã€‚

```JavaScript
import Highlighter from 'web-highlighter';

// 1. å®ä¾‹åŒ–
const highlighter = new Highlighter();

// 2. ä»åç«¯è·å–é«˜äº®ä¿¡æ¯ï¼Œè¿˜åŸè‡³ç½‘é¡µ
getRemoteData().then(s => highlighter.fromStore(s.startMeta, s.endMeta, s.id, s.text));

// 3. ç›‘å¬é«˜äº®ç¬”è®°åˆ›å»ºäº‹ä»¶ï¼Œå¹¶å°†ä¿¡æ¯å­˜è‡³åç«¯
highlighter.on(Highlighter.event.CREATE, ({sources}) => save(sources));

// 4. å¼€å¯è‡ªåŠ¨åˆ’è¯é«˜äº®
highlighter.run();
```

## ç¤ºä¾‹

ä¸€ä¸ªæ›´å¤æ‚çš„ä½¿ç”¨ç¤ºä¾‹ã€‚

```JavaScript
import Highlighter from 'web-highlighter';

// ä¸é«˜äº® pre&code å…ƒç´ 
const highlighter = new Highlighter({
    exceptSelectors: ['pre', 'code']
});

// æ·»åŠ ä¸€äº›äº¤äº’ç›‘å¬
highlighter
    .on('selection:hover', ({id}) => {
        // é€šè¿‡æ·»åŠ  classï¼Œå®ç°ç±»ä¼¼ hover æ•ˆæœ
        highlighter.addClass('highlight-wrap-hover', id);
    })
    .on('selection:hover-out', ({id}) => {
        // é¼ æ ‡ç¦»å¼€æ—¶æ¸…é™¤æ‚¬åœæ ·å¼
        highlighter.removeClass('highlight-wrap-hover', id);
    })
    .on('selection:create', ({sources}) => {
        sources = sources.map(hs => ({hs}));
        // å­˜å‚¨
        store.save(sources);
    });

// è·å–æ•°æ®å­˜å‚¨ï¼Œå°†é«˜äº®åŒºåŸŸè¿˜åŸå±•ç¤ºåœ¨ç½‘é¡µä¸Š
store.getAll().forEach(
    ({hs}) => highlighter.fromStore(hs.startMeta, hs.endMeta, hs.text, hs.id)
);

highlighter.run()
```

æ­¤å¤–ï¼Œè¯¥ä»“åº“è¿˜è‡ªå¸¦äº†ä¸€ä¸ª DEMO ç¤ºä¾‹ï¼ˆåœ¨`example`æ–‡ä»¶å¤¹ä¸­ï¼‰ã€‚å¯åŠ¨è¯¥ DEMO åªéœ€è¦ â€”â€”

é¦–å…ˆå®‰è£…è¿è¡Œä¾èµ–

```bash
npm i
```

ç„¶åå¯åŠ¨

```bash
npm start
```

æœ€åè®¿é—® http://127.0.0.1:8085/ å³å¯ã€‚

---

å¦ä¸€ä¸ªä½¿ç”¨ web-highlighter å¼€å‘çš„å®é™…äº§å“çš„ä¾‹å­ï¼ˆç”¨äºå·¦ä¾§é«˜äº®éƒ¨åˆ†ï¼‰ï¼š

![product sample](https://user-images.githubusercontent.com/9822789/64678049-632e8500-d4ab-11e9-99d6-f960bc90d17b.gif)


## API

### `highlighter = new Highlighter([opts])`

åˆ›å»ºä¸€ä¸ªæ–°çš„ `highlighter` å®ä¾‹.

`opts` ä¼šåˆå¹¶è‡³é»˜è®¤é…ç½® (å¦‚ä¸‹æ‰€ç¤º).

```JavaScript
{
    $root: document.documentElement,    // æ ¹å…ƒç´ ï¼Œç”¨äº addEventlistener / DFS / ...
    exceptSelectors: null,              // å½“å…ƒç´ ç¬¦åˆé€‰æ‹©å™¨æ¡ä»¶æ—¶ï¼Œåˆ™ä¸ä¼šè¢«é«˜äº®
    style: {
        className: 'highlight-wrap'     // å®ç°é«˜äº®çš„æœ¬è´¨æ˜¯ä¸ºå…¶åŒ…è£¹ spanï¼Œè¯¥é…ç½®ç”¨äºè®¾ç½® span çš„classname
    }
}
```

`exceptSelectors` ä¸º `null` æˆ– `Array<string>`ã€‚ æ”¯æŒ ID é€‰æ‹©å™¨ã€ç±»é€‰æ‹©å™¨å’Œæ ‡ç­¾é€‰æ‹©å™¨.

ä¾‹å¦‚ï¼Œæƒ³è¦å¿½ç•¥æ ‡ç­¾ä¸º h1 å’Œ classname ä¸º `.title` çš„å…ƒç´ ï¼š

```JavaScript
var highlighter = new Highlighter({
    exceptSelectors: ['h1', '.title']
});
```

### `highlighter.run()`

å¼€å¯è‡ªåŠ¨åˆ’è¯é«˜äº®ã€‚å½“ç”¨æˆ·é€‰æ‹©äº†ä¸€æ®µæ–‡æœ¬æ—¶ï¼Œã€Œweb-highlighterã€ä¼šè‡ªåŠ¨ä¸ºå…¶æ·»åŠ é«˜äº®æ•ˆæœã€‚

### `highlighter.stop()`

å…³é—­è‡ªåŠ¨åˆ’è¯é«˜äº®ã€‚

### `highlighter.dispose()`

å½“ä½ ä¸å†éœ€è¦ä½¿ç”¨é«˜äº®åŠŸèƒ½æ—¶ï¼Œéœ€è¦å…ˆä½¿ç”¨è¯¥æ–¹æ³•æ¥ç§»é™¤ä¸€äº›äº‹ä»¶ç›‘å¬ï¼Œå›æ”¶ä¸€äº›èµ„æºã€‚

### `highlighter.fromRange(range)`

è¯¥æ–¹æ³•æ”¯æŒä½ ä¼ ä¸€ä¸ª [`Range`](https://developer.mozilla.org/en-US/docs/Web/API/Range)ï¼Œå¹¶åŸºäºè¯¥å¯¹è±¡è¿›è¡Œé«˜äº®ç¬”è®°æ“ä½œã€‚ä½ å¯ä»¥é€šè¿‡ `window.getSelection().getRangeAt(0)` æ–¹æ³•æ¥è·å–ä¸€ä¸ª range å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨ `document.createRange()` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ range å¯¹è±¡ã€‚

å¦‚ä¸‹æ‰€ç¤ºï¼š

```JavaScript
const selection = window.getSelection();
if (selection.isCollapsed) {
    highlighter.fromRange(selection.getRangeAt(0));
}
```

### `highlighter.fromStore(start, end, text, id)`

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ª API ç”¨äºé€šè¿‡åç«¯çš„æŒä¹…åŒ–ä¿¡æ¯è¿˜åŸå‡ºæ–‡æœ¬é«˜äº®æ•ˆæœã€‚

å…¶ä¸­å››ä¸ªæ‰€éœ€çš„å‚æ•°æ¥æºäº `HighlightSource` å¯¹è±¡ã€‚`HighlightSource` å¯¹è±¡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå½“é«˜äº®ç¬”è®°è¢«æ·»åŠ æ—¶ä¼šè¢«åˆ›å»ºã€‚ä¸ºäº†èƒ½åœ¨åç«¯å®ç°æ•°æ®æŒä¹…åŒ–ï¼Œå®ƒéœ€è¦æ‰¾åˆ°ä¸€ç§èƒ½è¡¨ç¤º dom èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ã€‚è¿™ä¸ªç»“æ„åœ¨ web-highlighter å†…è¢«ç§°ä¸º`HighlightSource`ã€‚

å››ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š

- start `Object`:    å¼€å§‹èŠ‚ç‚¹çš„æºä¿¡æ¯
- end   `Object`:    ç»“æŸèŠ‚ç‚¹çš„æºä¿¡æ¯
- text  `string`:    æ–‡æœ¬å†…å®¹
- id    `string`:    é«˜äº®çš„å”¯ä¸€ ID

### `highlighter.remove(id)`

æ¸…é™¤æŒ‡å®š id çš„é«˜äº®åŒºåŸŸã€‚è¯¥ id é»˜è®¤ä¼šç”± web-highlighter åœ¨åˆ›å»ºé«˜äº®åŒºåŸŸä½¿ç”Ÿæˆã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ é’©å­æ¥åº”ç”¨ä½ è‡ªå·±çš„ id ç”Ÿæˆè§„åˆ™ã€‚é’©å­ç›¸å…³æ–‡æ¡£å¯ä»¥[çœ‹è¿™é‡Œ](https://github.com/alienzhou/web-highlighter/blob/master/docs/ADVANCE.zh_CN.md)ã€‚

### `highlighter.removeAll()`

æ¸…é™¤æ ¹èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é«˜äº®åŒºåŸŸã€‚

### `highlighter.addClass(classname, id)`

ä¸ºæŸä¸ª id çš„é«˜äº®åŒºåŸŸæ·»åŠ  CSS ç±»åã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ª API æ¥æ”¹å˜æŸä¸ªé«˜äº®åŒºåŸŸçš„æ ·å¼ã€‚

### `highlighter.removeClass(classname, id)`

ç§»é™¤æŸä¸ª id çš„é«˜äº®åŒºåŸŸçš„æŒ‡å®š CSS ç±»åã€‚ç±»ä¼¼äº `highlighter.addClass` çš„é€†æ“ä½œã€‚

### `highlighter.getDoms([id])`

è·å–é«˜äº®åŒºåŸŸå†…çš„æ‰€æœ‰åŒ…è£¹èŠ‚ç‚¹ã€‚ä¸€ä¸ªé«˜äº®åŒºåŸŸå¯èƒ½ä¼šåŒ…å«å¤šä¸ªç‰‡æ®µã€‚å®ƒä¼šè¿”å›æ‰€æœ‰è¿™äº›ç‰‡æ®µçš„åŒ…è£¹èŠ‚ç‚¹ï¼ˆDOM èŠ‚ç‚¹ï¼‰ã€‚

å¦‚æœ `id` å‚æ•°ç•™ç©ºï¼Œå®ƒä¼šè¿”å›æ ¹èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é«˜äº®åŒºåŸŸä¸­çš„åŒ…è£¹èŠ‚ç‚¹ã€‚

### `highlighter.getIdByDom(node)`

ä¼ å…¥ä¸€ä¸ªåŒ…è£¹èŠ‚ç‚¹ï¼Œè¿”å›è¯¥èŠ‚ç‚¹å¯¹åº”çš„é«˜äº®åŒºåŸŸå»çš„å”¯ä¸€ IDã€‚

### `Event Listener`

web-highlighter ä½¿ç”¨ç›‘å¬å™¨æ–¹å¼æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶ã€‚

ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼Œ

```JavaScript
var highlighter = new Highlighter();
highlighter.on(Highlighter.event.CREATE, function (data, inst, e) {
    // ...
});
```

å›è°ƒå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- data `any`: äº‹ä»¶è§¦å‘æ—¶çš„å…·ä½“æ•°æ®
- inst `Highligher`: å½“å‰ Highligher ç±»çš„å®ä¾‹
- e `Event`: æŸäº›äº‹ä»¶ä¼šæœ‰æµè§ˆå™¨è§¦å‘ï¼ˆä¾‹å¦‚ç‚¹å‡»ï¼‰, web-highlighter ä¼šå°†æµè§ˆå™¨åŸç”Ÿ event å¯¹è±¡æš´éœ²å‡ºæ¥

`Highlighter.event` æ˜¯å†…éƒ¨çš„ `EventType` ç±»å‹. å®ƒåŒ…å«äº†å¦‚ä¸‹è¿™äº›äº‹ä»¶ï¼š

- `EventType.CLICK`: ç‚¹å‡»é«˜äº®åŒºåŸŸ
- `EventType.HOVER`: é¼ æ ‡ç§»è‡³é«˜äº®åŒºåŸŸï¼Œç±»ä¼¼ mouseenter
- `EventType.HOVER_OUT`: é¼ æ ‡ç§»å‡ºé«˜äº®åŒºåŸŸï¼Œç±»ä¼¼ mouseleave
- `EventType.CREATE`: é«˜äº®åŒºåŸŸè¢«åˆ›å»º
- `EventType.REMOVE`: é«˜äº®åŒºåŸŸè¢«æ¸…é™¤

å¯¹äºä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œå…¶ `data` æ‰€åŒ…å«çš„å…·ä½“å±æ€§å¦‚ä¸‹ï¼š

#### `EventType.CLICK`

|name|description|type|
|---|---|---|
|`id`| é«˜äº®åŒºåŸŸå”¯ä¸€ ID |string|

#### `EventType.HOVER`

|name|description|type|
|---|---|---|
|`id`| é«˜äº®åŒºåŸŸå”¯ä¸€ ID |string|

#### `EventType.HOVER_OUT`

|name|description|type|
|---|---|---|
|`id`| é«˜äº®åŒºåŸŸå”¯ä¸€ ID |string|

#### `EventType.CREATE`

> ä¸åŒ…å«å‚æ•° `e`

|name|description|type|
|---|---|---|
|`source`|`HighlightSource` å¯¹è±¡|Array|
|`type`|é«˜äº®åŒºåŸŸåˆ›å»ºçš„æ¥æº|string|

`source` æ˜¯ä¸€ä¸ª `HighlightSource` å¯¹è±¡ã€‚è¯¥å¯¹è±¡åœ¨é«˜äº®åŒºåŸŸè¢«åˆ›å»ºæ—¶ï¼Œä¼šç”± web-highlighter åˆ›å»ºå¹¶ä¼ ç»™å›è°ƒå‡½æ•°ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨åç«¯ï¼ˆæ•°æ®åº“ä¸­ï¼‰è¿›è¡Œé«˜äº®æ•°æ®çš„æŒä¹…åŒ–ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¢«åºåˆ—åŒ–ï¼ˆ`JSON.stringify()`ï¼‰çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºæµè§ˆå™¨ä¸­çš„ DOM èŠ‚ç‚¹ã€‚`HighlightSource` å°±æ˜¯ web-highlighter æä¾›çš„æ¥ç”¨äºæŒä¹…åŒ–çš„æ•°æ®å¯¹è±¡ã€‚

`type` ç”¨æ¥å‘ŠçŸ¥å¼€å‘è€…é«˜äº®åŒºåŸŸè¢«åˆ›å»ºçš„åŸå› ã€‚ç›®å‰ `type` åŒ…å«ä¸¤ç§å¯èƒ½çš„å€¼ï¼š`from-input` å’Œ `from-store`ã€‚`from-input` è¡¨æ˜è¯¥é«˜äº®åŒºåŸŸæ˜¯é€šè¿‡ç”¨æˆ·æ“ä½œï¼ˆç”¨æˆ·åˆ’è¯çš„é€‰åŒºï¼‰åˆ›å»ºçš„ï¼›`from-store` åˆ™è¡¨ç¤ºè¯¥é«˜äº®åŒºåŸŸæ˜¯é€šè¿‡æŒä¹…åŒ–çš„ `HighlightSource` ä¸­çš„æ•°æ®è¿˜åŸå‡ºæ¥çš„ã€‚

#### `EventType.REMOVE`

> ä¸åŒ…å«å‚æ•° `e`

|name|description|type|
|---|---|---|
|`ids`|ä¸€ç»„é«˜äº®åŒºåŸŸå”¯ä¸€ ID|Array<string>|

## å…¼å®¹æ€§

> ä¾èµ– [Selection API](https://caniuse.com/#search=selection%20api)ã€‚

- IE 10ã€11
- Edge
- Firefox 52+
- Chrome 15+
- Safari 5.1+
- Opera 15+

## æ›´å¤šä½¿ç”¨æ–¹å¼

ä¸ºäº†ä¾¿äºå¼€å‘è€…æ›´å¥½åœ°æ§åˆ¶ç›¸å…³çš„é«˜äº®è¡Œä¸ºï¼Œweb-highlighter æä¾›ä¸€äº›å†…éƒ¨çš„é’©å­ã€‚

æƒ³äº†è§£å†…éƒ¨é’©å­åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥é˜…è¯»[è¿™ç¯‡æ–‡æ¡£](https://github.com/alienzhou/web-highlighter/blob/master/docs/ADVANCE.zh_CN.md)ã€‚

## è®¸å¯è¯

MIT
